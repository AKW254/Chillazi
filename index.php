<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chillazi Foodmart</title>
    <!--Favicon-->
    <link rel="icon" type="image/png" href="Storage/img/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="Storage/img/favicon/favicon.svg" />
    <link rel="shortcut icon" href="Storage/img/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="Storage/img/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="Storage/img/favicon/site.webmanifest" />
    <!-- End Favicon-->
    <!-- CSS here -->
    <link rel="stylesheet" href="Public/css/bootstrap.min.css">
    <link rel="stylesheet" href="Public/css/owl.carousel.min.css">
    <link rel="stylesheet" href="Public/css/slicknav.css">
    <link rel="stylesheet" href="Public/css/flaticon.css">
    <link rel="stylesheet" href="Public/css/gijgo.css">
    <link rel="stylesheet" href="Public/css/animate.min.css">
    <link rel="stylesheet" href="Public/css/magnific-popup.css">
    <link rel="stylesheet" href="Public/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="Public/css/themify-icons.css">
    <link rel="stylesheet" href="Public/css/slick.css">
    <link rel="stylesheet" href="Public/css/nice-select.css">
    <link rel="stylesheet" href="Public/css/style.css">
</head>

<body>
    <!--? Preloader Start -->
    <div id="preloader-active">
        <div class="preloader d-flex align-items-center justify-content-center">
            <div class="preloader-inner position-relative">
                <div class="preloader-circle"></div>
                <div class="preloader-img pere-text">
                    <img src="Storage/img/logo/logo.png" alt="">
                </div>
            </div>
        </div>
    </div>
    <!-- Preloader Start -->
    <header>
        <!--? Header Start -->
        <div class="header-area header-transparent">
            <div class="main-header  header-sticky">
                <div class="container-fluid">
                    <div class="row align-items-center">
                        <!-- Logo -->
                        <div class="col-xl-2 col-lg-2 col-md-1">
                            <div class="logo">
                                <a href="index.php"><img src="Storage/img/logo/logo.png" alt=""></a>
                            </div>
                        </div>
                        <div class="col-xl-10 col-lg-10 col-md-10">
                            <div class="menu-main d-flex align-items-center justify-content-end">
                                <!-- Main-menu -->
                                <div class="main-menu f-right d-none d-lg-block">
                                    <nav>
                                        <ul id="navigation">
                                            <li><a href="index.php">Home</a></li>
                                            <li><a href="#about">About</a></li>
                                            <li><a href="#contact">Contact</a></li>
                                        </ul>
                                    </nav>
                                </div>
                                <div class="header-right-btn f-right d-none d-lg-block ml-20">
                                    <!-- Trigger button -->
                                    <button type="button" data-toggle="modal" data-target="#chatpanel"
                                        class="border-btn header-btn">
                                        Order Online
                                    </button>

                                </div>
                            </div>
                        </div>
                        <!-- Mobile Menu -->
                        <div class="col-12">
                            <div class="mobile_menu d-block d-lg-none"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Header End -->
    </header>
    <main>
        <!-- slider Area Start-->
        <div class="slider-area ">
            <div class="slider-active">
                <!-- Single Slider -->
                <div class="single-slider slider-height d-flex align-items-center">
                    <div class="container">
                        <div class="row">
                            <div class="col-xl-9 col-lg-9 col-md-9">
                                <div class="hero__caption">
                                    <span data-animation="fadeInLeft" data-delay=".2s">Discover Your Teste</span>
                                    <h1 data-animation="fadeInLeft" data-delay=".4s">We belive good food offer great smile</h1>
                                    <p data-animation="fadeInLeft" data-delay=".6s">Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat is aute irure.</p>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Single Slider -->
                <div class="single-slider slider-height d-flex align-items-center">
                    <div class="container">
                        <div class="row">
                            <div class="col-xl-9 col-lg-9 col-md-9">
                                <div class="hero__caption">
                                    <span data-animation="fadeInLeft" data-delay=".2s">Discover Your Teste</span>
                                    <h1 data-animation="fadeInLeft" data-delay=".4s">We belive good food offer great smile</h1>
                                    <p data-animation="fadeInLeft" data-delay=".6s">Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat is aute irure.</p>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- slider Area End-->

        <!-- About-2 Area Start -->
        <div class="about-area2 section-padding30" id="about">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6 col-md-12">
                        <!-- about-img -->
                        <div class="about-img ">
                            <img src="Storage/img/gallery/about2.png" alt="">
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-12">
                        <div class="about-caption mb-50">
                            <!-- Section Tittle -->
                            <div class="section-tittle mb-35">
                                <span>About Our Restaurant</span>
                                <h2>We Provide Good Food For Your Family!</h2>
                            </div>
                            <p class="pera-top">Ut enim acgsd minim veniam, quxcis nostrud exercitation ullamco laboris nisi ufsit aliquip ex ea commodo consequat is aute irure m, quis nostrud exer</p>

                            <p class="mb-65 pera-bottom">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected our, or randomised words which don't look even slightly believab If you are going to use a passage.</p>
                            <a href="about.html" class="border-btn">Learn More</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- About-2 Area End -->

        <!-- ================ contact section start ================= -->
        <section class="contact-section" id="contact">
            <div class="container">
                <div class="row">
                    <div class="col-12">
                        <h2 class="contact-title">Get in Touch</h2>
                    </div>
                    <div class="col-lg-8">
                        <form class="form-contact contact_form" action="contact_process.php" method="post" id="contactForm" novalidate="novalidate">
                            <div class="row">
                                <div class="col-12">
                                    <div class="form-group">
                                        <textarea class="form-control w-100" name="message" id="message" cols="30" rows="9" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Enter Message'" placeholder=" Enter Message"></textarea>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <input class="form-control valid" name="name" id="name" type="text" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Enter your name'" placeholder="Enter your name">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <input class="form-control valid" name="email" id="email" type="email" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Enter email address'" placeholder="Email">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <div class="form-group">
                                        <input class="form-control" name="subject" id="subject" type="text" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Enter Subject'" placeholder="Enter Subject">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group mt-3">
                                <button type="submit" class="button button-contactForm boxed-btn">Send</button>
                            </div>
                        </form>
                    </div>
                    <div class="col-lg-3 offset-lg-1">
                        <div class="media contact-info">
                            <span class="contact-info__icon"><i class="ti-home"></i></span>
                            <div class="media-body">
                                <h3>Buttonwood, California.</h3>
                                <p>Rosemead, CA 91770</p>
                            </div>
                        </div>
                        <div class="media contact-info">
                            <span class="contact-info__icon"><i class="ti-tablet"></i></span>
                            <div class="media-body">
                                <h3>+1 253 565 2365</h3>
                                <p>Mon to Fri 9am to 6pm</p>
                            </div>
                        </div>
                        <div class="media contact-info">
                            <span class="contact-info__icon"><i class="ti-email"></i></span>
                            <div class="media-body">
                                <h3><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5d2e282d2d322f291d3e3231322f31343f733e3230">[email&#160;protected]</a></h3>
                                <p>Send us your query anytime!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- ================ contact section end ================= -->
    </main>
    <footer>
        <div class="col-md-4 d-flex align-items-center"> <a href="/" class="mb-3 me-2 mb-md-0 text-body-secondary text-decoration-none lh-1" aria-label="Bootstrap"> <svg class="bi" width="30" height="24" aria-hidden="true">
                    <use xlink:href="#bootstrap"></use>
                </svg> </a> <span class="mb-3 mb-md-0 text-body-secondary">© <?php echo date('Y'); ?> Chillazi FoodMart</span> </div>
        <ul class="nav col-md-4 justify-content-end list-unstyled d-flex">

            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="https://www.facebook.com/"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fas fa-globe"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
        </ul>
    </footer>
    <!-- Scroll Up -->
    <div id="back-top">
        <a title="Go to Top" href="#"> <i class="fas fa-level-up-alt"></i></a>
    </div>
    <!--Chat -->
    <!-- AI Assistant Chat Modal -->
    <!-- AI Assistant Chat Modal -->
    <div class="modal fade" id="chatpanel" tabindex="-1" role="dialog" aria-labelledby="chatpanelLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">

                <div class="modal-header">
                    <h5 class="modal-title" id="chatpanelLabel">AI Assistant</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <div id="chatMessages" style="height:300px; overflow-y:auto; border:1px solid #ccc; padding:10px; margin-bottom:10px;"></div>

                    <form id="chatForm">
                        <div class="input-group">
                            <input type="text" id="chatInput" class="form-control" placeholder="Type here..." required>
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="submit">Send</button>
                            </div>
                        </div>
                    </form>

                    <small id="chatHint" class="text-muted d-block mt-2"></small>
                </div>

            </div>
        </div>
    </div>


    <!-- JS here -->
    <script src="Public/js/vendor/modernizr-3.5.0.min.js"></script>
    <!-- Jquery, Popper, Bootstrap -->
    <script src="Public/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="Public/js/popper.min.js"></script>
    <script src="Public/js/bootstrap.min.js"></script>
    <!-- Jquery Mobile Menu -->
    <script src="Public/js/jquery.slicknav.min.js"></script>

    <!-- Jquery Slick , Owl-Carousel Plugins -->
    <script src="Public/js/owl.carousel.min.js"></script>
    <script src="Public/js/slick.min.js"></script>
    <!-- One Page, Animated-HeadLin -->
    <script src="Public/js/wow.min.js"></script>
    <script src="Public/js/animated.headline.js"></script>
    <script src="Public/js/jquery.magnific-popup.js"></script>

    <!-- Date Picker -->
    <script src="Public/js/gijgo.min.js"></script>
    <!-- Nice-select, sticky -->
    <script src="Public/js/jquery.nice-select.min.js"></script>
    <script src="Public/js/jquery.sticky.js"></script>

    <!-- contact js -->
    <script src="Public/js/contact.js"></script>
    <script src="Public/js/jquery.form.js"></script>
    <script src="Public/js/jquery.validate.min.js"></script>
    <script src="Public/js/mail-script.js"></script>
    <script src="Public/js/jquery.ajaxchimp.min.js"></script>

    <!-- Jquery Plugins, main Jquery -->
    <script src="Public/js/plugins.js"></script>
    <script src="Public/js/main.js"></script>
    <!-- Disable Preloader Script -->
    <script>
        window.addEventListener("load", function() {
            document.getElementById("preloader-active").style.display = "none";
        });
    </script>
    <!-- AI Assistant Chat Modal Script moved for maintainability -->
    <script>
        (function() {
            var chatMessages = null;
            var chatInput = null;
            var chatForm = null;
            var chatHint = null;
            //conversation token for context (not implemented in this example)
            var conversationToken = localStorage.getItem('conversation_token') || null;
            // Simple app state
            var state = {
                step: 'askName', // 'askName' -> 'askEmail' -> 'askPhone' -> 'chat'
                name: '',
                email: '',
                phone: ''
            };



            function appendAI(text) {
                chatMessages.innerHTML += '<div class="mb-2"><strong>AI:</strong> ' + escapeHtml(text) + '</div>';
                chatMessages.scrollTop = chatMessages.scrollHeight;

            }

            function appendYou(text) {
                chatMessages.innerHTML += '<div class="mb-2"><strong>You:</strong> ' + escapeHtml(text) + '</div>';
                chatMessages.scrollTop = chatMessages.scrollHeight;

            }

            function escapeHtml(str) {
                return (str || '').replace(/[&<>"]/g, function(t) {
                    return ({
                        '&': '&amp;',
                        '<': '&lt;',
                        '>': '&gt;',
                        '"': '&quot;'
                    } [t]);
                });
            }

            // Validation
            function isValidName(v) {
                return v && v.trim().length >= 2; // keep it friendly/non-formal
            }

            function isValidEmail(v) {
                // simple but effective
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
            }
            // Kenya-friendly phone normalization -> +2547XXXXXXXX or +2541XXXXXXXX
            function normalizeKEPhone(v) {
                if (!v) return '';
                var s = v.replace(/\D+/g, ''); // remove non-digits
                // Accept 07xxxxxxxx / 01xxxxxxxx
                if (/^07\d{8}$/.test(s) || /^01\d{8}$/.test(s)) {
                    return '+254' + s.substring(1); // 07... -> +2547...
                }
                // Accept 7xxxxxxxx or 1xxxxxxxx (missing leading 0)
                if (/^[71]\d{8}$/.test(s)) {
                    return '+254' + s;
                }
                // Accept 2547xxxxxxxx / 2541xxxxxxxx
                if (/^254[71]\d{8}$/.test(s)) {
                    return '+' + s;
                }
                // Accept +2547xxxxxxxx / +2541xxxxxxxx
                if (/^\+254[71]\d{8}$/.test(v)) {
                    return v;
                }
                return ''; // not valid (for our purposes)
            }

            // Typing indicator
            var typingTimer = null;

            function showTyping() {
                clearTyping();
                typingTimer = setTimeout(function() {
                    chatMessages.innerHTML += '<div id="typing" class="mb-2"><em>AI is typing…</em></div>';
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 150);
            }

            function clearTyping() {
                if (typingTimer) clearTimeout(typingTimer);
                var t = document.getElementById('typing');
                if (t) t.parentNode.removeChild(t);
            }

            // Step prompts
            function askName() {
                appendAI("Hey there 👋 What's your name?");
                chatHint.textContent = "e.g., Jane / John Doe";
                state.step = 'askName';
            }

            function askEmail() {
                appendAI("Nice to meet you, " + state.name + "! What's your email?");
                chatHint.textContent = "We'll use it to send order updates (e.g., you@example.com)";
                state.step = 'askEmail';
            }

            function askPhone() {
                appendAI("Great! Lastly, what’s your phone number?");
                chatHint.textContent = "Kenya format is fine (07..., 01..., or +254...)";
                state.step = 'askPhone';
            }

            function readyToChat() {
                appendAI("All set, " + state.name + "! How can I help you today? You can ask about the menu, place an order, or anything else.");
                chatHint.textContent = "";
                state.step = 'chat';
            }

            // Handle submit
            function onSubmit(e) {
                e.preventDefault();
                var msg = chatInput.value.trim();
                if (!msg) return;

                // Show user's message (always)
                appendYou(msg);
                chatInput.value = '';

                // Branch by step
                if (state.step === 'askName') {
                    if (!isValidName(msg)) {
                        appendAI("Got it — but could you share your name (at least 2 characters)?");
                        return;
                    }
                    state.name = msg;
                    askEmail();
                    return;
                }

                if (state.step === 'askEmail') {
                    if (!isValidEmail(msg)) {
                        appendAI("Hmm, that email doesn’t look right. Mind checking the format (like you@example.com)?");
                        return;
                    }
                    state.email = msg;
                    askPhone();
                    return;
                }

                if (state.step === 'askPhone') {
                    var normalized = normalizeKEPhone(msg);
                    if (!normalized) {
                        appendAI("That phone number seems off. Use 07..., 01..., 2547..., or +2547... format.");
                        return;
                    }
                    state.phone = normalized;
                    readyToChat();
                    return;
                }

                // Normal chat -> send to backend with captured profile
                showTyping();
                var payload = new URLSearchParams();
                payload.append('customer_name', state.name);
                payload.append('customer_email', state.email);
                payload.append('customer_phone', state.phone);
                payload.append('message', msg);
                if (conversationToken) {
                    payload.append('conversation_token', conversationToken);
                }

                fetch('assistant.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                        },
                        body: payload.toString()
                    })
                    .then(function(res) {
                        return res.json();
                    })
                    .then(function(data) {
                        clearTyping();
                        if (data && data.reply) {
                            appendAI(data.reply);
                        } else if (data && data.error) {
                            appendAI("Oops, there was an error: " + data.error);
                        }
                        // Save conversation token if provided
                        if (data && data.conversation_token) {
                            conversationToken = data.conversation_token;
                            localStorage.setItem('conversationToken', conversation_token);
                        }

                    })
                    .catch(function(err) {
                        clearTyping();
                        appendAI("Network error — please try again.");
                        console.error(err);
                    });
            }

            // Init on DOM ready
            document.addEventListener('DOMContentLoaded', function() {
                chatMessages = document.getElementById('chatMessages');
                chatInput = document.getElementById('chatInput');
                chatForm = document.getElementById('chatForm');
                chatHint = document.getElementById('chatHint');

                chatForm.addEventListener('submit', onSubmit);


                $('#chatpanel').on('shown.bs.modal', function() {

                    chatInput.value = '';
                    if (!state.name) {
                        askName();
                    } else if (!state.email) {
                        askEmail();
                    } else if (!state.phone) {
                        askPhone();
                    } else {
                        readyToChat();
                    }
                    chatInput.focus();
                })



            });
        })();
    </script>

    <!--AI Assistant Chat Modal Script-->

</body>

</html>